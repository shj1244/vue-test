(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["admConfig"],{"414b":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[r("v-btn",e._g(e._b({class:e.childClass,on:{click:function(t){return e.$emit("click")}}},"v-btn",Object.assign({},e.$attrs,a),!1),n),[e._t("default")],2)]}}],null,!0)},[r("span",[e._v(e._s(e.label))])])},a=[],i={name:"ToolTipBtn",props:{label:{type:String,required:!0},childClass:[String,Object]},mounted:function(){}},o=i,c=r("2877"),l=Object(c["a"])(o,n,a,!1,null,null,null);t["a"]=l.exports},9415:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-toolbar",[r("v-toolbar-title",[e._v("설정관리")]),r("v-spacer"),r("tooltip-btn",{attrs:{fab:"",small:"",label:"설정 추가",color:"primary"},on:{click:e.addConfig}},[r("v-icon",[e._v("mdi-plus")])],1),r("tooltip-btn",{attrs:{fab:"",small:"",label:"서버 재시작",color:"error",childClass:"ml-2",loading:e.restart},on:{click:e.restartServer}},[r("v-icon",[e._v("mdi-power")])],1)],1),r("v-row",[r("v-col",[r("v-tabs",{attrs:{"background-color":"primary",dark:""},model:{value:e.group,callback:function(t){e.group=t},expression:"group"}},e._l(e.groupItems,(function(t){return r("v-tab",{key:t.cf_key},[e._v(" "+e._s(t)+" ")])})),1)],1)],1),r("draggable",{staticClass:"list-group",attrs:{tag:"ul",list:e.curItems,handle:".handle"},on:{end:e.sortEnd}},e._l(e.curItems,(function(t){return r("config-item",{key:t.cf_key,staticClass:"list-group-item",attrs:{item:t},on:{update:e.updateConfig,remove:e.removeConfig}})})),1),r("ez-dialog",{ref:"dialog",attrs:{label:"설정추가","max-width":"500",dark:"",color:"primary",persistent:""}},[r("config-form",{ref:"configForm",attrs:{keyCheck:e.keyCheck,groupItems:e.groupItems,item:e.item},on:{save:e.save}})],1)],1)},a=[],i=r("1da1"),o=r("2909"),c=r("5530"),l=(r("96cf"),r("d3b7"),r("6062"),r("3ca3"),r("ddb0"),r("159b"),r("a434"),r("4e82"),r("4de4"),r("2f62")),s=r("a2e4"),u=r("414b"),f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.member?r("v-form",{ref:"form",attrs:{"lazy-validation":""},on:{submit:function(t){return t.preventDefault(),e.save.apply(null,arguments)}},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[r("v-combobox",{attrs:{items:e.groupItems,label:"그룹",rules:[e.rules.require({label:"그룹"})]},model:{value:e.form.cf_group,callback:function(t){e.$set(e.form,"cf_group",t)},expression:"form.cf_group"}}),r("div",{staticClass:"d-flex"},[r("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[r("span",e._g(e._b({staticClass:"mr-2"},"span",a,!1),n),[r("v-checkbox",{attrs:{color:"primary","true-value":1,"false-value":0},model:{value:e.form.cf_client,callback:function(t){e.$set(e.form,"cf_client",t)},expression:"form.cf_client"}})],1)]}}],null,!1,220026471)},[r("span",[e._v("클라이언트")])]),r("input-duplicate-check",{ref:"cfKey",attrs:{label:"키",cbCheck:e.keyCheck,origin:e.orginKey,readonly:!!e.item,rules:[e.rules.require({label:"키"}),e.rules.alphaNum()]},model:{value:e.form.cf_key,callback:function(t){e.$set(e.form,"cf_key",t)},expression:"form.cf_key"}})],1),r("v-text-field",{attrs:{label:"이름",rules:e.rules.name()},model:{value:e.form.cf_name,callback:function(t){e.$set(e.form,"cf_name",t)},expression:"form.cf_name"}}),r("v-select",{attrs:{label:"값 타입",items:e.typeItems},model:{value:e.form.cf_type,callback:function(t){e.$set(e.form,"cf_type",t)},expression:"form.cf_type"}}),r("type-value",{attrs:{fieldType:e.form.cf_type},model:{value:e.form.cf_val,callback:function(t){e.$set(e.form,"cf_val",t)},expression:"form.cf_val"}}),r("v-slider",{attrs:{label:"접근레벨 ("+e.form.cf_level+")",min:e.LV.ADMIN,max:e.member.mb_level,"thumb-color":"primary","thumb-label":""},model:{value:e.form.cf_level,callback:function(t){e.$set(e.form,"cf_level",t)},expression:"form.cf_level"}}),r("v-textarea",{attrs:{label:"설명"},model:{value:e.form.cf_comment,callback:function(t){e.$set(e.form,"cf_comment",t)},expression:"form.cf_comment"}}),r("v-btn",{attrs:{type:"submit",block:""}},[e._v("저장")])],1):e._e()},m=[],p=r("50d8"),v=function(){var e=this,t=e.$createElement,r=e._self._c||t;return"String"==e.fieldType?r("div",[r("v-text-field",{attrs:{label:"Value(문자)",value:e.value,readonly:e.readonly,"hide-details":e.readonly},on:{input:e.onInput}})],1):"Number"==e.fieldType?r("div",[r("v-text-field",{attrs:{label:"Value(숫자)",type:"number",value:e.value,readonly:e.readonly,"hide-details":e.readonly},on:{input:e.onInput}})],1):"CheckBox"==e.fieldType?r("div",[r("v-checkbox",{attrs:{label:"Check value","input-value":e.value,readonly:e.readonly,"hide-details":e.readonly,"true-value":"1","false-value":"0"},on:{change:e.onInput}})],1):"Json"==e.fieldType?r("div",[e.readonly?[r("v-btn",{attrs:{color:"primary"},on:{click:e.jsonView}},[e._v("JSON 보기")]),r("ez-dialog",{ref:"dialog",attrs:{label:"JSON 값 보기",width:"600"}},[r("pre",{staticClass:"mt-4"},[e._v(e._s(e.stringify()))])])]:r("v-textarea",{attrs:{label:"Value",value:e.value,readonly:e.readonly,"hide-details":e.readonly},on:{input:e.onInput}})],2):"Secret"==e.fieldType?r("div",[r("input-password",{attrs:{label:"Secret Value",value:e.value,readonly:e.readonly,"hide-details":e.readonly},on:{input:e.onInput}})],1):r("div",[r("div",[e._v("타입을 먼저 선택해 주세요.")])])},d=[],b=r("bbf4"),_=r("ac4f"),g=r.n(_),h={components:{inputPassword:b["a"],EzDialog:s["a"]},name:"TypeValue",model:{prop:"value",event:"input"},props:{value:{type:String},fieldType:{type:String,default:"String"},readonly:{type:Boolean,default:!1}},methods:{onInput:function(e){this.$emit("input",e)},stringify:function(){var e=JSON.parse(this.value),t=g()(e,{space:"  "});return t},jsonView:function(){this.$refs.dialog.open()}}},y=h,k=r("2877"),x=Object(k["a"])(y,v,d,!1,null,null,null),$=x.exports,C=r("bb5e"),O=r("248f"),w=r.n(O),j=r("64f2"),I={components:{InputDuplicateCheck:p["a"],TypeValue:$},name:"ConfigForm",props:{keyCheck:{type:Function,default:null},groupItems:{type:Array,default:[]},item:{type:Object,default:null}},data:function(){return{valid:!0,form:null,typeItems:["String","Number","CheckBox","Json","Secret"],orginKey:null}},computed:Object(c["a"])({LV:function(){return C["LV"]},rules:function(){return w.a}},Object(l["e"])({member:function(e){return e.user.member}})),created:function(){this.init()},watch:{item:function(){this.init()}},methods:{init:function(){if(this.item){if(this.form=Object(j["deepCopy"])(this.item),"Json"==this.form.cf_type){var e=JSON.parse(this.form.cf_val);this.form.cf_val=g()(e,{space:"  "})}this.orginKey=this.item.cf_key}else this.form={cf_key:"",cf_val:"",cf_name:"",cf_group:"",cf_level:"",cf_type:"String",cf_comment:"",cf_client:0},this.orginKey="";this.$refs.form&&this.$refs.form.resetValidation()},save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.form.validate(),t.next=3,e.$nextTick();case 3:if(e.valid){t.next=5;break}return t.abrupt("return");case 5:if(e.$refs.cfKey.validate()){t.next=7;break}return t.abrupt("return");case 7:e.item||(r=0,n=Object(j["findParentVm"])(e,"admConfig"),n.items.forEach((function(t){t.cf_group==e.form.cf_group&&r++})),e.form.cf_sort=r);try{"Json"==e.form.cf_type&&(a=JSON.parse(e.form.cf_val),e.form.cf_val=JSON.stringify(a)),e.$emit("save",e.form)}catch(i){e.$toast.error("JSON 형식이 올바르지 않습니다.")}case 9:case"end":return t.stop()}}),t)})))()}}},S=I,T=Object(k["a"])(S,f,m,!1,null,null,null),N=T.exports,V=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.member?r("li",[r("v-icon",{staticClass:"handle"},[e._v("mdi-drag")]),r("div",[r("div",[r("div",[r("b",[e._v(e._s(e.item.cf_name))])]),r("div",[r("pre",{staticClass:"comment",domProps:{innerHTML:e._s(e.item.cf_comment)}})]),r("div",[r("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[r("v-avatar",e._g(e._b({attrs:{color:"primary",dark:"",size:"32"}},"v-avatar",a,!1),n),[r("span",{staticClass:"white--text"},[e._v(e._s(e.item.cf_level))])])]}}],null,!1,4089557389)},[r("span",[e._v("접근레벨")])])],1),r("div",[r("v-btn",{attrs:{icon:"",disabled:e.isGrant},on:{click:function(t){return e.$emit("update",e.item)}}},[r("v-icon",[e._v("mdi-pencil")])],1)],1)]),r("div",[r("div",[r("b",[e._v(e._s(e.item.cf_key))])]),r("div",[r("type-value",{attrs:{fieldType:e.item.cf_type,value:e.item.cf_val,readonly:!0}})],1),r("div",[r("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[r("div",e._g(e._b({staticClass:"client"},"div",a,!1),n),[r("v-checkbox",{attrs:{readonly:"","hide-details":"",dense:""},model:{value:e.item.cf_client,callback:function(t){e.$set(e.item,"cf_client",t)},expression:"item.cf_client"}})],1)]}}],null,!1,2442821590)},[r("span",[e._v("클라이언트 접근유무")])])],1),r("div",[r("v-btn",{attrs:{icon:"",disabled:e.isGrant},on:{click:function(t){return e.$emit("remove",e.item)}}},[r("v-icon",[e._v("mdi-delete")])],1)],1)])])],1):e._e()},E=[],J={components:{TypeValue:$},name:"ConfigItem",props:{item:{type:Object,required:!0}},computed:Object(c["a"])(Object(c["a"])({},Object(l["e"])({member:function(e){return e.user.member}})),{},{isGrant:function(){return this.item.cf_level>this.member.mb_level}})},R=J,D=Object(k["a"])(R,V,E,!1,null,null,null),z=D.exports,F=r("b76a"),K=r.n(F),q={components:{TooltipBtn:u["a"],EzDialog:s["a"],ConfigForm:N,ConfigItem:z,draggable:K.a},name:"admConfig",title:"설정 관리",data:function(){return{items:[],group:-1,curItems:[],item:null,restart:!1}},computed:Object(c["a"])(Object(c["a"])({},Object(l["e"])({online:function(e){return e.socket.online}})),{},{groupItems:function(){var e=new Set;return this.items.forEach((function(t){e.add(t.cf_group)})),Object(o["a"])(e)},groupName:function(){return this.groupItems[this.group]||""}}),watch:{online:function(){this.online&&(this.$toast.info("서버가 재시작 되었습니다."),this.restart=!1)},group:function(){this.setCurItems()}},mounted:function(){this.fetchData()},methods:Object(c["a"])(Object(c["a"])({},Object(l["b"])(["configDuplicateCheck","configSave"])),{},{addConfig:function(){this.item=null,this.$refs.configForm&&this.$refs.configForm.init(),this.$refs.dialog.open()},updateConfig:function(e){this.item=e,this.$refs.configForm&&this.$refs.configForm.init(),this.$refs.dialog.open()},removeConfig:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ezNotify.confirm("<b>[".concat(e.cf_name,"]</b> 삭제 하시겠습니까?"),"설정항목삭제",{icon:"mdi-delete",iconColor:"red"});case 2:if(n=r.sent,n){r.next=5;break}return r.abrupt("return");case 5:return r.next=7,t.$axios.delete("/api/config/".concat(e.cf_key));case 7:a=r.sent,a&&(e.cf_client&&t.$socket.emit("config:remove",e.cf_key),t.$toast.info("[".concat(e.cf_name,"] 삭제 하였습니다.")),i=t.items.indexOf(e),t.items.splice(i,1),t.setCurItems());case 9:case"end":return r.stop()}}),r)})))()},save:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.configSave(e);case 2:n=r.sent,n.cf_client?t.$socket.emit("config:update",{key:n.cf_key,value:n.cf_val}):t.item&&t.item.cf_client&&t.$socket.emit("config:remove",n.cf_key),t.item?(t.$toast.info("[".concat(e.cf_name,"] 수정 하였습니다.")),a=t.items.indexOf(t.item),t.items.splice(a,1,n)):(t.$toast.info("[".concat(e.cf_name,"] 추가 하였습니다.")),t.items.push(n)),t.setCurItems(),t.$refs.dialog.close();case 7:case"end":return r.stop()}}),r)})))()},keyCheck:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.configDuplicateCheck({field:"cf_key",value:e});case 2:return n=r.sent,r.abrupt("return",n);case 4:case"end":return r.stop()}}),r)})))()},fetchData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.get("/api/config?all=true");case 2:e.items=t.sent;case 3:case"end":return t.stop()}}),t)})))()},sortEnd:function(){var e=0,t=[];this.curItems.forEach((function(r){r.cf_sort=e++,t.push({cf_key:r.cf_key,cf_sort:r.cf_sort})})),this.$axios.put("/api/config",t)},setCurItems:function(){var e=this;this.curItems=this.items.filter((function(t){return t.cf_group==e.groupName})).sort((function(e,t){return e.cf_sort-t.cf_sort}))},restartServer:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ezNotify.confirm("서버 재시작 요청을 하시겠습니까?","서버 재시작",{icon:"mdi-power",iconColor:"red"});case 2:if(r=t.sent,r){t.next=5;break}return t.abrupt("return");case 5:return e.restart=!0,t.next=8,e.$axios.get("/api/config/restart");case 8:n=t.sent,n?setTimeout((function(){e.restart&&(e.$toast.error("서버가 재시작 실패하였습니다.\n잠시 후 다시 시도 하세요."),e.restart=!1)}),2e4):e.restart=!1;case 10:case"end":return t.stop()}}),t)})))()}})},B=q,L=Object(k["a"])(B,n,a,!1,null,null,null);t["default"]=L.exports},a2e4:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-dialog",e._b({model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},"v-dialog",e.$attrs,!1),[r("v-card",[r("v-toolbar",e._b({},"v-toolbar",e.$attrs,!1),[r("v-toolbar-title",[e._v(e._s(e.label))]),r("v-spacer"),r("v-btn",{attrs:{icon:""},on:{click:e.close}},[r("v-icon",[e._v("mdi-close")])],1)],1),r("v-card-text",[e._t("default")],2)],1)],1)},a=[],i={name:"ezDialog",props:{label:{type:String,required:!0}},data:function(){return{dialog:!1}},methods:{open:function(){this.$emit("onOpen"),this.dialog=!0},close:function(){this.dialog=!1,this.$emit("onClose")}}},o=i,c=r("2877"),l=Object(c["a"])(o,n,a,!1,null,null,null);t["a"]=l.exports}}]);
//# sourceMappingURL=admConfig.f5828fc1.js.map